Update Makefiles

From: Curt Brune <curt@cumulusnetworks.com>

Modify the Makefiles slightly to mesh with the ONIE build environment.
---
 Cryptlib/Makefile         |    8 ++++++--
 Cryptlib/OpenSSL/Makefile |    8 ++++++--
 Makefile                  |    9 +++++++--
 3 files changed, 19 insertions(+), 6 deletions(-)

diff --git a/Cryptlib/Makefile b/Cryptlib/Makefile
index a028979..8b65d6c 100644
--- a/Cryptlib/Makefile
+++ b/Cryptlib/Makefile
@@ -1,7 +1,11 @@
 
 EFI_INCLUDES	= -IInclude -I$(EFI_INCLUDE) -I$(EFI_INCLUDE)/$(ARCH) -I$(EFI_INCLUDE)/protocol
 
-CFLAGS		= -ggdb -O0 -I. -fno-stack-protector -fno-strict-aliasing -fpic -fshort-wchar \
+# Seed compiler and linker flags ONIE build environment flags
+CFLAGS		= $(ONIE_CFLAGS)
+LDFLAGS		= $(ONIE_LDFLAGS)
+
+CFLAGS		+= -ggdb -O0 -I. -fno-stack-protector -fno-strict-aliasing -fpic -fshort-wchar \
 		  -Wall $(EFI_INCLUDES) -std=gnu89 \
 		  -ffreestanding -I$(shell $(CC) -print-file-name=include)
 
@@ -17,7 +21,7 @@ endif
 ifeq ($(ARCH),aarch64)
 	CFLAGS	+= -DMDE_CPU_AARCH64
 endif
-LDFLAGS		= -nostdlib -znocombreloc
+LDFLAGS		+= -nostdlib -znocombreloc
 
 TARGET		= libcryptlib.a
 OBJS		=   Hash/CryptMd4.o \
diff --git a/Cryptlib/OpenSSL/Makefile b/Cryptlib/OpenSSL/Makefile
index 1b80e02..bb9547f 100644
--- a/Cryptlib/OpenSSL/Makefile
+++ b/Cryptlib/OpenSSL/Makefile
@@ -1,7 +1,11 @@
 
 EFI_INCLUDES	= -I../Include -I$(EFI_INCLUDE) -I$(EFI_INCLUDE)/$(ARCH) -I$(EFI_INCLUDE)/protocol -Icrypto/asn1 -Icrypto/evp -Icrypto/modes
 
-CFLAGS		= -ggdb -O0 -I. -I.. -I../Include/ -Icrypto -fno-stack-protector -fno-strict-aliasing -fpic -fshort-wchar -nostdinc \
+# Seed compiler and linker flags ONIE build environment flags
+CFLAGS		= $(ONIE_CFLAGS)
+LDFLAGS		= $(ONIE_LDFLAGS)
+
+CFLAGS		+= -ggdb -O0 -I. -I.. -I../Include/ -Icrypto -fno-stack-protector -fno-strict-aliasing -fpic -fshort-wchar -nostdinc \
 		  -ffreestanding -std=gnu89 -I$(shell $(CC) -print-file-name=include) \
 		  -Wall $(EFI_INCLUDES) -DL_ENDIAN -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -DOPENSSL_SMALL_FOOTPRINT -DPEDANTIC
 
@@ -20,7 +24,7 @@ endif
 ifeq ($(ARCH),arm)
 	CFLAGS	+= -O2 -DMDE_CPU_ARM
 endif
-LDFLAGS		= -nostdlib -znocombreloc
+LDFLAGS		+= -nostdlib -znocombreloc
 
 TARGET		= libopenssl.a
 OBJS		=   crypto/cryptlib.o \
diff --git a/Makefile b/Makefile
index c02cc94..c6b0b66 100644
--- a/Makefile
+++ b/Makefile
@@ -23,7 +23,12 @@ EFI_CRT_OBJS 	= $(EFI_PATH)/crt0-efi-$(ARCH).o
 EFI_LDS		= elf_$(ARCH)_efi.lds
 
 DEFAULT_LOADER	:= \\\\grub.efi
-CFLAGS		= -ggdb -O0 -fno-stack-protector -fno-strict-aliasing -fpic \
+
+# Seed compiler and linker flags ONIE build environment flags
+CFLAGS		= $(ONIE_CFLAGS)
+LDFLAGS		= $(ONIE_LDFLAGS)
+
+CFLAGS		+= -ggdb -O0 -fno-stack-protector -fno-strict-aliasing -fpic \
 		  -fshort-wchar -Wall -Wsign-compare -Werror -fno-builtin \
 		  -Werror=sign-compare -ffreestanding -std=gnu89 \
 		  -I$(shell $(CC) -print-file-name=include) \
@@ -84,7 +89,7 @@ ifneq ($(origin VENDOR_DBX_FILE), undefined)
 	CFLAGS += -DVENDOR_DBX_FILE=\"$(VENDOR_DBX_FILE)\"
 endif
 
-LDFLAGS		= --hash-style=sysv -nostdlib -znocombreloc -T $(EFI_LDS) -shared -Bsymbolic -L$(EFI_PATH) -L$(LIB_PATH) -LCryptlib -LCryptlib/OpenSSL $(EFI_CRT_OBJS) --build-id=sha1
+LDFLAGS		+= --hash-style=sysv -nostdlib -znocombreloc -T $(EFI_LDS) -shared -Bsymbolic -L$(EFI_PATH) -L$(LIB_PATH) -LCryptlib -LCryptlib/OpenSSL $(EFI_CRT_OBJS) --build-id=sha1
 
 TARGET	= $(SHIMNAME).efi $(MMNAME).efi.signed $(FBNAME).efi.signed
 OBJS	= shim.o netboot.o cert.o replacements.o tpm.o version.o
